# 需求文档 - 几何变换与裁剪

## 简介

本需求文档定义了计算机图形学实验三的功能需求。该实验在前两个实验的基础上，添加几何变换（平移、缩放、旋转）和图形裁剪功能（直线裁剪和多边形裁剪）。系统需要支持用户通过鼠标交互选择图形、定义变换参数、指定裁剪区域，并使用多种经典算法实现裁剪操作。

## 需求

### 需求 1：任意多边形绘制

**用户故事：** 作为用户，我希望能够通过鼠标绘制任意多边形，以便创建可用于后续变换和裁剪操作的图形对象。

#### 验收标准

1. WHEN 用户点击"绘制多边形"菜单项或工具条按钮 THEN 系统应进入多边形绘制模式
2. WHEN 用户在绘图区域点击鼠标左键 THEN 系统应记录该点作为多边形的一个顶点
3. WHEN 用户移动鼠标 THEN 系统应实时显示从上一个顶点到当前鼠标位置的预览线段
4. WHEN 用户连续点击多个点 THEN 系统应依次连接这些点形成多边形的边
5. WHEN 用户点击鼠标右键或双击左键 THEN 系统应完成多边形绘制并自动闭合多边形
6. IF 多边形顶点少于3个 THEN 系统应提示用户至少需要3个顶点
7. WHEN 多边形绘制完成 THEN 系统应将该多边形保存为可选择的图形对象

### 需求 2：图形选择机制

**用户故事：** 作为用户，我希望能够选择已绘制的图形，以便对其进行变换或裁剪操作。

#### 验收标准

1. WHEN 用户点击"选择图形"菜单项或工具条按钮 THEN 系统应进入图形选择模式
2. WHEN 用户在绘图区域点击鼠标 THEN 系统应检测点击位置附近的图形对象
3. IF 点击位置附近存在图形对象 THEN 系统应高亮显示该图形表示已选中
4. WHEN 图形被选中 THEN 系统应显示该图形的边界框或控制点
5. WHEN 用户点击空白区域 THEN 系统应取消当前选中的图形
6. WHEN 图形被选中 THEN 系统应启用变换相关的菜单项和按钮

### 需求 3：图形平移变换

**用户故事：** 作为用户，我希望能够平移选中的图形，以便调整图形在画布上的位置。

#### 验收标准

1. WHEN 用户选中一个图形并点击"平移"菜单项 THEN 系统应进入平移模式
2. WHEN 用户在平移模式下点击鼠标左键 THEN 系统应记录起始位置
3. WHEN 用户拖动鼠标 THEN 系统应实时显示图形平移后的预览效果
4. WHEN 用户释放鼠标左键 THEN 系统应完成平移操作并更新图形位置
5. WHEN 平移操作完成 THEN 系统应重新绘制画布显示变换后的图形
6. IF 没有选中图形 THEN 平移菜单项应处于禁用状态

### 需求 4：图形缩放变换

**用户故事：** 作为用户，我希望能够缩放选中的图形，以便调整图形的大小。

#### 验收标准

1. WHEN 用户选中一个图形并点击"缩放"菜单项 THEN 系统应进入缩放模式
2. WHEN 用户在缩放模式下点击鼠标左键 THEN 系统应记录缩放中心点（默认为图形中心）
3. WHEN 用户拖动鼠标向外移动 THEN 系统应放大图形并实时显示预览
4. WHEN 用户拖动鼠标向内移动 THEN 系统应缩小图形并实时显示预览
5. WHEN 用户释放鼠标左键 THEN 系统应完成缩放操作并更新图形
6. WHEN 缩放操作完成 THEN 系统应保持图形的形状比例
7. IF 没有选中图形 THEN 缩放菜单项应处于禁用状态

### 需求 5：图形旋转变换

**用户故事：** 作为用户，我希望能够绕指定点旋转选中的图形，以便调整图形的方向。

#### 验收标准

1. WHEN 用户选中一个图形并点击"旋转"菜单项 THEN 系统应进入旋转模式
2. WHEN 用户在旋转模式下点击鼠标左键 THEN 系统应记录该点作为旋转中心
3. WHEN 用户移动鼠标 THEN 系统应根据鼠标位置相对于旋转中心的角度实时显示旋转预览
4. WHEN 用户点击鼠标右键或再次点击左键 THEN 系统应完成旋转操作并更新图形
5. WHEN 旋转操作完成 THEN 系统应保持图形的大小和形状
6. IF 没有选中图形 THEN 旋转菜单项应处于禁用状态

### 需求 6：裁剪区域定义

**用户故事：** 作为用户，我希望能够通过鼠标定义矩形裁剪区域，以便对图形进行裁剪操作。

#### 验收标准

1. WHEN 用户点击裁剪相关菜单项 THEN 系统应进入裁剪区域定义模式
2. WHEN 用户在绘图区域点击鼠标左键 THEN 系统应记录矩形的第一个角点
3. WHEN 用户拖动鼠标 THEN 系统应实时显示裁剪矩形的预览（虚线框）
4. WHEN 用户释放鼠标左键 THEN 系统应确定裁剪矩形区域
5. WHEN 裁剪区域确定后 THEN 系统应高亮显示该区域
6. WHEN 裁剪区域定义完成 THEN 系统应自动执行相应的裁剪算法

### 需求 7：Cohen-Sutherland 直线裁剪

**用户故事：** 作为用户，我希望使用 Cohen-Sutherland 算法裁剪直线，以便快速去除矩形窗口外的线段部分。

#### 验收标准

1. WHEN 用户点击"Cohen-Sutherland 裁剪"菜单项 THEN 系统应进入该裁剪模式
2. WHEN 用户定义裁剪矩形后 THEN 系统应对画布上所有直线对象应用 Cohen-Sutherland 算法
3. WHEN 直线完全在裁剪区域内 THEN 系统应保留整条直线
4. WHEN 直线完全在裁剪区域外 THEN 系统应删除该直线
5. WHEN 直线部分在裁剪区域内 THEN 系统应计算交点并只保留区域内的线段部分
6. WHEN 裁剪完成 THEN 系统应保持其他类型图形（圆、多边形等）不变
7. WHEN 裁剪完成 THEN 系统应重新绘制画布显示裁剪结果

### 需求 8：中点分割直线裁剪

**用户故事：** 作为用户，我希望使用中点分割算法裁剪直线，以便通过递归方式精确裁剪线段。

#### 验收标准

1. WHEN 用户点击"中点分割裁剪"菜单项 THEN 系统应进入该裁剪模式
2. WHEN 用户定义裁剪矩形后 THEN 系统应对画布上所有直线对象应用中点分割算法
3. WHEN 算法执行时 THEN 系统应递归地将线段分割为两半直到满足裁剪条件
4. WHEN 线段端点都在区域内 THEN 系统应保留该线段
5. WHEN 线段端点都在区域外且在同一侧 THEN 系统应删除该线段
6. WHEN 线段跨越裁剪边界 THEN 系统应继续分割直到找到精确的交点
7. WHEN 裁剪完成 THEN 系统应保持其他类型图形不变

### 需求 9：Sutherland-Hodgman 多边形裁剪

**用户故事：** 作为用户，我希望使用 Sutherland-Hodgman 算法裁剪多边形，以便保留矩形窗口内的多边形部分。

#### 验收标准

1. WHEN 用户点击"Sutherland-Hodgman 裁剪"菜单项 THEN 系统应进入该裁剪模式
2. WHEN 用户定义裁剪矩形后 THEN 系统应对画布上所有多边形对象应用 Sutherland-Hodgman 算法
3. WHEN 算法执行时 THEN 系统应依次对裁剪矩形的四条边进行裁剪
4. WHEN 多边形顶点在裁剪边内侧 THEN 系统应保留该顶点
5. WHEN 多边形边跨越裁剪边 THEN 系统应计算交点并添加到结果多边形
6. WHEN 多边形完全在裁剪区域外 THEN 系统应删除该多边形
7. WHEN 裁剪完成 THEN 系统应保持直线、圆等其他类型图形不变
8. WHEN 裁剪完成 THEN 系统应重新绘制画布显示裁剪后的多边形

### 需求 10：Weiler-Atherton 多边形裁剪

**用户故事：** 作为用户，我希望使用 Weiler-Atherton 算法裁剪多边形，以便处理凹多边形和复杂裁剪情况。

#### 验收标准

1. WHEN 用户点击"Weiler-Atherton 裁剪"菜单项 THEN 系统应进入该裁剪模式
2. WHEN 用户定义裁剪矩形后 THEN 系统应对画布上所有多边形对象应用 Weiler-Atherton 算法
3. WHEN 算法执行时 THEN 系统应构建多边形和裁剪窗口的交点链表
4. WHEN 算法执行时 THEN 系统应标记交点的进入/离开属性
5. WHEN 算法执行时 THEN 系统应沿着多边形边界和裁剪窗口边界追踪形成结果多边形
6. WHEN 多边形为凹多边形 THEN 系统应正确处理并生成多个结果多边形（如需要）
7. WHEN 裁剪完成 THEN 系统应保持直线、圆等其他类型图形不变
8. WHEN 裁剪完成 THEN 系统应重新绘制画布显示裁剪后的多边形

### 需求 11：用户界面与交互

**用户故事：** 作为用户，我希望有清晰的菜单结构和视觉反馈，以便轻松使用各种变换和裁剪功能。

#### 验收标准

1. WHEN 系统启动 THEN 菜单栏应包含"变换"和"裁剪"菜单
2. WHEN 用户查看"变换"菜单 THEN 应显示"选择图形"、"平移"、"缩放"、"旋转"等选项
3. WHEN 用户查看"裁剪"菜单 THEN 应显示各种裁剪算法选项
4. WHEN 用户进行操作 THEN 系统应在状态栏或标题栏显示当前模式
5. WHEN 用户进行变换或裁剪操作 THEN 系统应提供实时视觉预览
6. WHEN 操作完成 THEN 系统应提供视觉确认（如闪烁或消息提示）
7. IF 操作无效（如未选中图形） THEN 系统应显示友好的错误提示

### 需求 12：数据持久化与撤销

**用户故事：** 作为用户，我希望系统能够保存图形对象的状态，以便在需要时撤销操作。

#### 验收标准

1. WHEN 用户绘制或变换图形 THEN 系统应将图形对象保存到内部数据结构
2. WHEN 用户执行裁剪操作 THEN 系统应更新受影响图形对象的数据
3. WHEN 系统保存图形对象 THEN 应包含图形类型、顶点坐标、颜色等属性
4. WHEN 用户点击"新建"菜单 THEN 系统应清空所有图形对象并重置画布
5. IF 系统实现撤销功能 THEN 应能恢复到上一个操作状态
6. WHEN 画布重绘时 THEN 系统应遍历所有图形对象并重新绘制
